# LIHC多维度预后分析系统 - 用户使用指南

## 🚀 快速开始

### 系统要求
- **操作系统**: Windows 10+, macOS 10.15+, Linux Ubuntu 18.04+
- **浏览器**: Chrome 80+, Firefox 75+, Safari 13+, Edge 80+
- **内存**: 推荐8GB以上RAM
- **存储**: 至少5GB可用空间

### 安装部署

#### 方式一：Docker一键部署（推荐）

```bash
# 1. 克隆项目
git clone https://github.com/ai-guoke/lihc-analysis-platform.git
cd lihc-analysis-platform

# 2. 一键启动
docker-compose -f docker-compose.professional.yml up -d

# 3. 访问系统
open http://localhost:8050
```

#### 方式二：Python本地部署

```bash
# 1. 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或 venv\Scripts\activate  # Windows

# 2. 安装依赖
pip install -r requirements-minimal.txt

# 3. 启动系统
python main.py --professional

# 4. 访问系统
open http://localhost:8050
```

---

## 📱 界面导览

### 主界面布局
系统采用现代化的专业布局设计：

- **顶部导航栏**: 数据管理、演示案例、系统设置
- **侧边导航栏**: 分析功能、高级分析、分析结果
- **主内容区**: 动态内容展示区域
- **状态栏**: 系统状态和进度信息

### 核心功能模块

| 功能模块 | 访问路径 | 主要功能 |
|---------|---------|----------|
| 📊 **数据管理** | 数据管理 → 数据上传 | 数据上传、模板下载、数据验证 |
| 🗺️ **多维分析** | 分析功能 → 多维度分析 | 五维度肿瘤微环境分析 |
| 🕸️ **网络分析** | 分析功能 → 网络分析 | 分子相互作用网络分析 |
| 📈 **生存分析** | 分析功能 → 生存分析 | Kaplan-Meier生存曲线分析 |
| 🧠 **智能分析** | 高级分析 → ClosedLoop分析 | 因果推理和多组学整合 |
| 🎯 **精准医学** | 高级分析 → 精准医学分析 | 免疫、药物、代谢等专项分析 |
| 📋 **结果中心** | 分析结果 → 历史结果 | 分析结果查看和下载 |

---

## 📤 数据准备与上传

### 数据格式要求

#### 1. 基因表达数据 (expression_data.csv)
```csv
Gene_Symbol,Sample_001,Sample_002,Sample_003,Sample_004
TP53,12.45,8.23,15.67,11.23
EGFR,20.12,18.45,22.34,19.78
KRAS,5.67,7.89,4.32,6.45
MYC,15.23,13.45,17.89,14.56
```

**格式说明**：
- 第一列：基因符号（Gene Symbol）
- 后续列：样本表达值（推荐使用log2转换后的值）
- 缺失值用空白或NA表示

#### 2. 临床数据 (clinical_data.csv)
```csv
Sample_ID,Age,Gender,Stage,Grade,OS_Time,OS_Status
Sample_001,65,Male,II,G2,850,1
Sample_002,58,Female,I,G1,1200,0
Sample_003,72,Male,III,G3,450,1
Sample_004,61,Female,IV,G4,320,1
```

**字段说明**：
- `Sample_ID`: 样本编号（必须与表达数据列名对应）
- `Age`: 年龄
- `Gender`: 性别（Male/Female）
- `Stage`: 病理分期（I/II/III/IV）
- `Grade`: 病理分级（G1/G2/G3/G4）
- `OS_Time`: 总生存时间（天）
- `OS_Status`: 生存状态（0=存活，1=死亡）

#### 3. 拷贝数变异数据 (cnv_data.csv)
```csv
Gene_Symbol,Sample_001,Sample_002,Sample_003,Sample_004
TP53,-0.5,0.2,-1.2,0.1
EGFR,1.5,0.8,2.1,1.2
KRAS,0.2,-0.3,0.5,-0.1
```

**格式说明**：
- 值范围：-3到3（log2拷贝数比值）
- 负值表示缺失，正值表示扩增

#### 4. 突变数据 (mutation_data.csv)
```csv
Gene_Symbol,Sample_ID,Mutation_Type,Variant_Classification
TP53,Sample_001,SNP,Missense_Mutation
KRAS,Sample_002,SNP,Nonsense_Mutation
EGFR,Sample_003,INDEL,Frame_Shift_Del
TP53,Sample_004,SNP,Silent
```

#### 5. 甲基化数据 (methylation_data.csv)
```csv
Probe_ID,Gene_Symbol,Sample_001,Sample_002,Sample_003
cg00000029,RBL2,0.23,0.45,0.12
cg00000103,C1orf170,0.67,0.78,0.56
cg00000109,C1orf170,0.34,0.29,0.41
```

**格式说明**：
- 值范围：0-1（Beta值）
- 0表示未甲基化，1表示完全甲基化

### 数据上传流程

#### 步骤1：模板下载
1. 访问**数据管理** → **数据上传**页面
2. 点击**下载数据模板**按钮
3. 选择需要的数据类型（基因表达、临床数据等）
4. 下载对应的CSV模板文件

#### 步骤2：数据准备
1. 按照模板格式整理您的数据
2. 确保样本ID在所有文件中保持一致
3. 检查数据格式和缺失值处理
4. 保存为UTF-8编码的CSV文件

#### 步骤3：数据上传
1. 在数据上传页面选择文件类型
2. 点击**选择文件**按钮上传数据
3. 系统自动进行数据验证
4. 查看验证结果和数据预览
5. 确认无误后点击**保存数据**

#### 步骤4：数据验证反馈
系统会自动检查：
- ✅ 文件格式是否正确
- ✅ 样本ID是否匹配
- ✅ 数据类型是否符合要求
- ✅ 缺失值比例是否在合理范围
- ✅ 数据分布是否正常

---

## 🔬 分析功能使用

### 多维度肿瘤微环境分析

#### 功能概述
通过五个生物学维度全面分析肿瘤微环境，识别关键的治疗靶点。

#### 操作步骤
1. **选择数据集**：在页面顶部选择要分析的数据集
2. **设置分析参数**：
   - 差异表达阈值：|log2FC| > 1, p-value < 0.05
   - 网络构建方法：相关性网络或调控网络
   - Linchpin评分权重：默认或自定义权重
3. **启动分析**：点击**开始多维度分析**按钮
4. **查看结果**：
   - Top 20关键靶点表格
   - 多维度评分雷达图
   - 网络中心性分布图
   - 跨维度相关性热图

#### 结果解读
- **Linchpin评分**：综合评分越高，基因作为治疗靶点的潜力越大
- **网络中心性**：反映基因在分子网络中的重要程度
- **预后评分**：与患者生存预后的关联强度
- **跨维度连接性**：连接不同生物学维度的能力

### 生存分析

#### Kaplan-Meier生存曲线分析

**操作步骤**：
1. 选择目标基因（如TP53, EGFR, KRAS）
2. 选择生存事件类型（总生存期OS或无复发生存期RFS）
3. 设置分组阈值（中位数、上下四分位数或自定义）
4. 点击**生成生存曲线**按钮

**结果包含**：
- 高低表达组生存曲线
- Log-rank检验p值
- 风险比（Hazard Ratio）和95%置信区间
- 中位生存时间
- 5年生存率比较

#### Cox比例风险回归分析

**功能**：评估多个因素对生存的影响
**操作**：
1. 选择协变量（年龄、性别、分期等）
2. 选择目标基因
3. 运行多变量Cox回归
4. 查看森林图和风险比结果

### 网络分析

#### 分子相互作用网络构建

**网络类型**：
- **相关性网络**：基于基因表达相关性
- **调控网络**：转录因子-靶基因调控关系
- **蛋白互作网络**：基于STRING数据库
- **通路网络**：KEGG通路间的crosstalk

**网络分析指标**：
- **度中心性**：节点连接数
- **介数中心性**：节点在最短路径上的重要性
- **紧密中心性**：节点到其他节点的平均距离
- **特征向量中心性**：考虑邻居节点重要性的中心性

**可视化特性**：
- 3D网络布局
- 节点大小表示重要性
- 边粗细表示相关强度
- 交互式缩放和旋转

### ClosedLoop因果推理分析

#### 功能原理
通过整合多种证据类型，识别具有因果关系的驱动基因，而非仅仅是相关关系。

#### 五种证据类型
1. **差异表达证据**：肿瘤vs正常组织的表达差异
2. **生存关联证据**：基因表达与患者预后的关联
3. **CNV驱动证据**：拷贝数变异对基因表达的驱动作用
4. **甲基化调控证据**：DNA甲基化对基因表达的调控
5. **突变频率证据**：体细胞突变在患者群体中的富集

#### 操作流程
1. 上传多组学数据（表达、CNV、突变、甲基化）
2. 设置证据权重（可使用默认权重）
3. 设置因果推理参数
4. 运行ClosedLoop分析
5. 查看因果评分和证据链

#### 结果输出
- **高置信度因果基因列表**
- **证据链追踪报告**
- **因果网络可视化**
- **通路富集分析结果**

### 精准医学分析

#### 免疫微环境分析
1. **访问路径**：高级分析 → 精准医学分析 → 免疫微环境
2. **分析内容**：
   - CIBERSORT免疫细胞去卷积
   - 免疫评分（ESTIMATE算法）
   - 免疫检查点表达分析
   - 免疫治疗响应预测
3. **结果展示**：
   - 22种免疫细胞比例饼图
   - 免疫、基质、纯度评分柱状图
   - 免疫检查点表达热图
   - 免疫治疗响应概率

#### 药物响应预测
1. **功能**：预测患者对不同药物的敏感性
2. **方法**：基于基因表达特征的机器学习模型
3. **输出**：
   - 药物敏感性评分
   - 推荐药物排序
   - 耐药风险评估
   - 替代药物建议

#### 分子亚型分类
1. **聚类方法**：
   - K-means聚类
   - 层次聚类
   - 一致性聚类
2. **亚型特征**：
   - 每个亚型的标志基因
   - 生存预后差异
   - 分子通路特征
   - 临床特征关联

---

## 📊 结果查看与导出

### 历史结果管理

#### 结果列表
- **分析记录**：显示所有历史分析任务
- **分析状态**：运行中、已完成、失败
- **创建时间**：分析任务创建时间
- **数据集信息**：使用的数据集名称
- **分析类型**：多维度分析、生存分析等

#### 结果查看
1. 在结果列表中点击**查看结果**按钮
2. 系统打开结果详情页面
3. 包含所有图表、表格和分析报告
4. 支持图表交互和数据探索

### 结果导出功能

#### 图表导出
- **PNG格式**：适合PPT和文档插入
- **SVG格式**：矢量图，适合论文发表
- **PDF格式**：高质量打印版本
- **HTML格式**：交互式网页版本

#### 数据导出
- **Excel格式**：分析结果表格
- **CSV格式**：原始数据和计算结果
- **JSON格式**：结构化数据交换

#### 报告生成
1. **HTML报告**：包含所有图表和分析结果的完整报告
2. **PDF报告**：适合打印和分享的正式报告
3. **PowerPoint模板**：预设的演示文稿模板

---

## 🛠️ 高级功能

### 批量数据处理

#### 功能说明
支持同时上传和分析多个数据集，提高工作效率。

#### 操作流程
1. 在数据管理页面选择**批量上传**
2. 上传包含多个数据集的ZIP文件
3. 系统自动解析和验证每个数据集
4. 选择要执行的分析类型
5. 设置批量分析参数
6. 启动批量分析任务

#### 进度监控
- **任务队列**：显示所有待处理任务
- **实时进度**：显示当前任务执行进度
- **结果通知**：任务完成后的自动通知

### 数据集管理

#### 数据集注册
- **自动元数据提取**：文件大小、样本数、基因数
- **自定义标签**：添加项目、疾病类型等标签
- **描述信息**：详细的数据集描述
- **权限管理**：设置数据集访问权限

#### 数据集操作
- **重命名**：修改数据集名称
- **复制**：创建数据集副本
- **合并**：将多个数据集合并
- **删除**：删除不需要的数据集

### 系统设置

#### 分析参数配置
- **统计阈值**：p-value、FDR、fold change阈值
- **网络参数**：相关性阈值、网络布局算法
- **可视化设置**：颜色方案、字体大小、图表尺寸

#### 语言和界面
- **语言切换**：中文/英文界面切换
- **主题设置**：明亮/暗黑主题选择
- **布局偏好**：侧边栏收缩、页面布局

#### 数据存储
- **存储路径**：设置数据和结果存储位置
- **清理策略**：自动清理过期结果
- **备份设置**：自动备份重要数据

---

## 🔧 故障排除

### 常见问题

#### 1. 数据上传失败
**问题现象**：文件上传后提示验证失败
**可能原因**：
- 文件格式不正确
- 样本ID不匹配
- 文件编码问题

**解决方案**：
1. 检查文件是否为UTF-8编码的CSV格式
2. 确保表达数据和临床数据的样本ID完全一致
3. 检查是否有特殊字符或空格
4. 重新下载模板并按格式整理数据

#### 2. 分析任务失败
**问题现象**：分析开始后显示失败状态
**可能原因**：
- 数据质量问题
- 内存不足
- 网络连接中断

**解决方案**：
1. 检查数据中是否有过多缺失值
2. 减少分析的基因数量
3. 重启Docker容器
4. 检查系统日志获取详细错误信息

#### 3. 结果显示异常
**问题现象**：图表无法显示或显示错误
**可能原因**：
- 浏览器兼容性问题
- 缓存问题
- JavaScript错误

**解决方案**：
1. 刷新页面或清除浏览器缓存
2. 使用Chrome或Firefox浏览器
3. 检查浏览器控制台是否有错误信息
4. 确保JavaScript已启用

#### 4. 性能问题
**问题现象**：系统响应缓慢
**可能原因**：
- 数据集过大
- 系统资源不足
- 并发用户过多

**解决方案**：
1. 使用数据筛选减少分析规模
2. 增加系统内存配置
3. 在非高峰时段进行大规模分析
4. 使用批量处理功能

### 技术支持

#### 获取帮助
- **在线文档**：访问系统内置帮助页面
- **GitHub Issues**：提交技术问题和功能建议
- **邮件支持**：technical-support@lihc-platform.org
- **社区论坛**：参与用户讨论和经验分享

#### 提交Bug报告
包含以下信息：
1. 详细的问题描述
2. 重现步骤
3. 错误截图
4. 浏览器和操作系统信息
5. 数据集信息（如果相关）

---

## 💡 最佳实践

### 数据准备建议

#### 数据质量控制
1. **表达数据**：
   - 使用log2转换的标准化数据
   - 过滤低表达基因（平均表达值 < 1）
   - 去除异常样本（通过PCA等方法识别）

2. **临床数据**：
   - 确保生存时间和状态数据完整
   - 统一分期和分级的命名规范
   - 处理缺失值（删除或插值）

#### 样本量建议
- **最小样本量**：50个样本（用于统计分析）
- **推荐样本量**：100-500个样本（获得稳定结果）
- **大规模分析**：1000+样本（发现罕见事件）

### 分析流程建议

#### 标准分析流程
1. **数据探索**：首先进行基础的描述性分析
2. **质量控制**：检查数据分布和异常值
3. **多维度分析**：识别关键的生物学模块
4. **生存分析**：验证候选基因的预后价值
5. **网络分析**：理解基因间的相互作用
6. **结果验证**：使用独立数据集验证发现

#### 参数设置建议
- **差异表达**：|log2FC| > 1, adjusted p-value < 0.05
- **生存分析**：使用中位数分组，至少观察2年
- **网络构建**：相关系数阈值 > 0.6
- **多重校正**：使用FDR方法控制假阳性率

---

## 📈 案例研究

### 案例1：肝癌预后标志物发现

**研究背景**：使用TCGA-LIHC数据集识别新的预后标志物

**分析流程**：
1. 上传TCGA-LIHC表达和临床数据（377个样本）
2. 运行多维度分析识别关键基因
3. 生存分析验证Top候选基因
4. 网络分析理解基因功能模块
5. 免疫微环境分析探索治疗靶点

**主要发现**：
- 识别出15个高置信度预后标志物
- 发现免疫检查点相关的预后基因
- 构建了包含120个基因的预后网络
- 提出3个潜在的免疫治疗靶点

### 案例2：多组学整合分析

**研究背景**：整合RNA-seq、CNV、突变数据发现驱动基因

**数据准备**：
- 表达数据：20,000基因 × 200样本
- CNV数据：15,000基因 × 200样本  
- 突变数据：500个突变基因
- 临床数据：完整的生存信息

**分析步骤**：
1. 多组学数据整合（使用SNF方法）
2. ClosedLoop因果推理分析
3. 驱动基因功能注释
4. 药物靶点预测分析

**关键结果**：
- 识别出8个高置信度驱动基因
- 发现3个新的药物靶点
- 构建了包含五种证据的因果网络
- 提出个性化治疗建议

---

## 📚 延伸学习

### 推荐资源

#### 生物信息学基础
- **《生物信息学导论》**：系统学习生物信息学基本概念
- **Coursera生物信息学课程**：在线学习平台
- **Nature Biotechnology**：关注前沿技术发展

#### 统计分析方法
- **《R语言实战》**：学习R语言数据分析
- **《Python生物信息学编程》**：Python编程技能
- **《现代统计学方法》**：掌握高级统计方法

#### 系统生物学
- **《系统生物学原理》**：理解系统生物学思维
- **网络生物学专题**：深入学习网络分析方法
- **多组学数据分析**：掌握整合分析技术

### 实践建议

#### 技能提升路径
1. **基础阶段**：掌握基本的数据分析概念
2. **进阶阶段**：学习统计学和机器学习方法
3. **专业阶段**：深入理解生物学背景和意义
4. **创新阶段**：开发新的分析方法和工具

#### 项目实践
- 从公开数据库下载数据进行练习
- 参与开源项目贡献代码
- 在学术会议上分享分析结果
- 与生物学家合作开展研究项目

---

*祝您使用愉快！如有任何问题，请及时联系我们的技术支持团队。* 🚀✨